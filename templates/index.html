<!DOCTYPE html>
<html>
<head>
    <title>VT Hash â†’ SHA256 Converter</title>

    <style>
        body {
            font-family: Arial;
            background: #111;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .card {
            background: #1e1e1e;
            padding: 30px;
            border-radius: 10px;
            width: 400px;
            margin: auto;
        }

        input, button {
            width: 100%;
            margin-top: 12px;
            padding: 10px;
            border-radius: 5px;
            border: none;
        }

        button {
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #45a049;
        }

        #progress {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>

<div class="card">
    <h2>VirusTotal Hash Converter</h2>

    <input type="text" id="apikey" placeholder="VirusTotal API Key">
    <input type="file" id="file">
    <button onclick="start()">Start</button>

    <div id="progress"></div>
</div>

<script>
function start() {
    const api = document.getElementById("apikey").value.trim();
    const file = document.getElementById("file").files[0];
    const div = document.getElementById("progress");

    if (!api || !file) {
        div.innerHTML = "Please provide API key and select a file.";
        return;
    }

    div.innerHTML = "Uploading file...";

    const form = new FormData();
    form.append("apikey", api);
    form.append("file", file);

    fetch("/upload", { method: "POST", body: form })
    .then(r => r.json())
    .then(data => {
        if (data.job_id) {
            checkStatus(data.job_id);
        } else {
            div.innerHTML = "Failed to start job.";
        }
    })
    .catch(err => {
        div.innerHTML = "Upload error: " + err;
    });
}

function checkStatus(job) {
    const div = document.getElementById("progress");

    const timer = setInterval(() => {
        fetch("/status/" + job)
        .then(r => r.json())
        .then(d => {
            if (!d.status) return;

            if (d.status === "processing" || d.status === "queued") {
                div.innerHTML = "Progress: " + (d.progress || 0) + "%";
            }

            if (d.status === "done") {
                clearInterval(timer);
                div.innerHTML = "Done! Download starting...";
                window.location = "/download/" + job;
            }

            if (d.status === "error") {
                clearInterval(timer);
                div.innerHTML = "Error occurred: " + (d.error || "Unknown error");
            }
        })
        .catch(err => {
            clearInterval(timer);
            div.innerHTML = "Status check error: " + err;
        });
    }, 3000);
}
</script>

</body>
</html>
